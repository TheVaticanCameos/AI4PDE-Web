<!DOCTYPE html>  
<html lang="zh">  
<head>  
    <meta charset="UTF-8">  
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>PDEæ±‚è§£å™¨</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {  
            margin: 0;  
            padding: 20px;  
            display: flex;  
            justify-content: space-between;  
            align-items: flex-start;  
            font-family: Arial, sans-serif;  
            background-color: #f0f4f8;  
            transition: background-color 0.3s, color 0.3s;  
        }  
        body.dark-mode {  
            background-color: #333;  
            color: #ffffff;  
        }  
        .slider-container {  
            flex: 1;  
            margin-right: 20px;  
            padding: 20px;  
            background-color: #ffffff;  
            border: 1px solid #ddd;  
            border-radius: 8px;  
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);  
            transition: background-color 0.3s, border-color 0.3s;  
        }  
        .slider-container.dark-mode {  
            background-color: #444;  
            border-color: #555;  
        }  
        .image-container {  
            flex: 1;  
            text-align: center;  
            padding: 20px;  
            background-color: #ffffff;  
            border: 1px solid #ddd;  
            border-radius: 8px;  
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);  
            transition: background-color 0.3s, border-color 0.3s;  
        }  
        .image-container.dark-mode {  
            background-color: #000000;  
            border-color: #555;  
        }  
        h1.light-mode {  
            color: #0000007d;  
            font-size: 24px;  
        }  
        h1.dark-mode {  
            color: #ffffff;  
            font-size: 24px;  
        }  
        h2.light-mode {  
            color: #666;  
            font-size: 1.2em;  
            margin-top: 5px;  
        }  
        h2.dark-mode {  
            color: #cac4c4;  
            font-size: 1.2em;  
            margin-top: 5px;  
        }  
        h3.light-mode {  
            color: #4e4c4c;  
            margin: 15px 0;  
        }  
        h3.dark-mode {  
            color: #b8b3b3c4;  
            margin: 15px 0;  
        }  
        .output {  
            margin-top: 10px;  
            font-size: 1.2em;  
            font-weight: bold;  
        }  
        .output.light-mode {  
            color: #000000; /* æµ…è‰²æ¨¡å¼ä¸‹çš„é¢œè‰² */  
        }  
        .output.dark-mode {  
            color: #ffffff; /* æ·±è‰²æ¨¡å¼ä¸‹çš„é¢œè‰² */  
        }  
        input[type="range"] {  
            width: 80%;  
            margin: 20px 0;  
        }  
        input[type="number"] {  
            width: 70px;  
            text-align: center;  
            margin: 0 5px;  
        }  
        button {  
            padding: 10px 20px;  
            font-size: 16px;  
            color: #ffffff;  
            background-color: #007BFF; /* é»˜è®¤ä¸ºè“è‰² */  
            border: none;  
            border-radius: 5px;  
            cursor: pointer;  
            transition: background-color 0.3s;  
        }  
        button:hover {  
            background-color: #ccc;  
        }  
        button:hover.dark-mode {  
            background-color: #ccc;  
        }  
        #themeToggle {  
            position: absolute;  
            top: 20px;  
            right: 20px;  
            width: 40px;  
            height: 40px;  
            border: none;  
            border-radius: 50%;  
            background-color: #007BFF;  
            color: #ffffff;  
            font-size: 20px;  
            cursor: pointer;  
            display: flex;  
            justify-content: center;  
            align-items: center;  
            transition: background-color 0.3s;  
        }  
        .dark-mode #themeToggle {  
            background-color: #b8b7b7; /* æµ…ç°è‰² */  
        }
        /* æµ…è‰²æ¨¡å¼ä¸‹æŒ‰é’®æ ·å¼ */  
        button.light-mode {  
            background-color: #007BFF; /* è“è‰² */  
            color: #ffffff; /* ç™½è‰²å­—ä½“ */  
        }  
        /* æ·±è‰²æ¨¡å¼ä¸‹æŒ‰é’®æ ·å¼ */  
        button.dark-mode {  
            background-color: #4d59b3de; /* ç°è“è‰² */  
            color: #ffffff; /* ç™½è‰²å­—ä½“ */  
        }  
        /* å…¶ä»–å®¹å™¨æ ·å¼ */  
        .slider-container, .image-container {  
            margin: 10px;  
            padding: 10px;  
            border: 1px solid #ccc;  
            border-radius: 5px;  
            background-color: #ffffff;  
            transition: background-color 0.3s;  
        }  
        /* æ·±è‰²æ¨¡å¼å®¹å™¨æ ·å¼ */  
        .slider-container.dark-mode, .image-container.dark-mode {  
            background-color: #0000007d;  
            border-color: #f9f8f889;  
            color: #ffffff;  
        }
        #plotlyDiv {
            width: 100px; /* è®¾ç½®ä¸€ä¸ªåˆé€‚çš„å®½åº¦ */
            height: 100px; /* è®¾ç½®ä¸€ä¸ªåˆé€‚çš„é«˜åº¦ */
        }
    </style>  
</head>  
<body>  
    <div class="slider-container">  
        <h1>PDEæ±‚è§£å™¨</h1>  
        <h2>ç›®å‰åªèƒ½è§£Poissonæ–¹ç¨‹ï¼ˆu"(x)=f(x)ï¼‰ã€‚</h2>  
        <h3 id="sliderValues">å½“å‰f(x): </h3>  

        <div>  
            <button onclick="addSlider()">å¢åŠ xçš„å¹‚æ•°</button>  
            <button id="themeToggle" onclick="toggleTheme()">  
                <span id="themeIcon">ğŸŒ™</span>  
            </button>  
        </div>  

        <div id="sliders"></div>  
        <button onclick="sendData()">å‘é€æ•°æ®</button>
    </div>  

    <div class="image-container">  
        <div id="solutionCanvas" ></div>
        <p>u(x)</p>  
    </div>
    <script>  
        let sliderCount = -1;  

        function toggleTheme() {  
            document.body.classList.toggle('dark-mode');  
            document.querySelectorAll('.slider-container, .image-container').forEach(container => {  
                container.classList.toggle('dark-mode');  
            });  

            const sliderValue = document.getElementById('themeIcon');  
            sliderValue.innerText = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';  

            if (document.body.classList.contains('dark-mode')) {  
                sliderValue.classList.add('dark-mode');  
                sliderValue.classList.remove('light-mode');  
            } else {  
                sliderValue.classList.add('light-mode');  
                sliderValue.classList.remove('dark-mode');  
            }  

            const button = document.getElementById('themeToggle');  
            // åˆ‡æ¢æŒ‰é’®æ ·å¼  
            if (document.body.classList.contains('dark-mode')) {  
                button.classList.add('dark-mode');  
                button.classList.remove('light-mode');  
            } else {  
                button.classList.add('light-mode');  
                button.classList.remove('dark-mode');  
            }  

            // åˆ‡æ¢å…¶ä»–æŒ‰é’®çš„æ ·å¼  
            document.querySelectorAll('button').forEach(btn => {  
                if (document.body.classList.contains('dark-mode')) {  
                    btn.classList.add('dark-mode');  
                    btn.classList.remove('light-mode');  
                } else {  
                    btn.classList.add('light-mode');  
                    btn.classList.remove('dark-mode');  
                }  
            });  

            // åˆ‡æ¢æ»‘å—å€¼æ–‡æœ¬çš„æ ·å¼  
            document.querySelectorAll('.output').forEach(output => {  
                if (document.body.classList.contains('dark-mode')) {  
                    output.classList.add('dark-mode');  
                    output.classList.remove('light-mode');  
                } else {  
                    output.classList.add('light-mode');  
                    output.classList.remove('dark-mode');  
                }  
            });  
        }  

        // åˆå§‹åŒ–  
        addSlider();  

        function addSlider() {
            sliderCount++;

            // åˆ›å»ºä¸€ä¸ªæ–°çš„æ»‘å—
            var sliderContainer = document.createElement('div');
            sliderContainer.className = 'slider-container';

            // æ ¹æ®å½“å‰é¡µé¢ä¸»é¢˜é€‰æ‹©å®¹å™¨æ ·å¼
            if (document.body.classList.contains('dark-mode')) {
                sliderContainer.classList.add('dark-mode');
            } else {
                sliderContainer.classList.add('light-mode');
            }

            var titleLabel = document.createElement('label');
            titleLabel.innerText = 'x^' + sliderCount;

            // åˆ›å»ºè¾“å…¥æ¡†
            var minInput = document.createElement('input');
            minInput.type = 'number';
            minInput.placeholder = 'æœ€å°å€¼';
            minInput.value = 1;

            var maxInput = document.createElement('input');
            maxInput.type = 'number';
            maxInput.placeholder = 'æœ€å¤§å€¼';
            maxInput.value = 100;

            // åˆ›å»ºæ»‘å—
            var rangeInput = document.createElement('input');
            rangeInput.type = 'range';
            rangeInput.oninput = function() {
                sliderValue.innerText = rangeInput.value;
                updateSliderValuesDisplay();
            };

            // åˆ›å»ºè¾“å‡ºå€¼æ–‡æœ¬
            var sliderValue = document.createElement('span');
            sliderValue.className = 'output';
            sliderValue.innerText = rangeInput.value;

            // æ ¹æ®å½“å‰é¡µé¢ä¸»é¢˜é€‰æ‹©è¾“å‡ºå€¼æ–‡æœ¬é¢œè‰²
            if (document.body.classList.contains('dark-mode')) {
                sliderValue.classList.add('dark-mode');
            } else {
                sliderValue.classList.add('light-mode');
            }

            // æ·»åŠ å…ƒç´ 
            sliderContainer.appendChild(titleLabel);
            sliderContainer.appendChild(minInput);
            sliderContainer.appendChild(maxInput);
            sliderContainer.appendChild(rangeInput);
            sliderContainer.appendChild(sliderValue);

            // æ»‘å—æ›´æ–°
            function updateRange() {
                var minValue = parseInt(minInput.value);
                var maxValue = parseInt(maxInput.value);

                if (minValue > maxValue) {
                    alert("æœ€å°å€¼å¿…é¡»å°äºç­‰äºæœ€å¤§å€¼ï¼");
                    return;
                }

                rangeInput.min = minValue;
                rangeInput.max = maxValue;
                rangeInput.value = Math.max(minValue, Math.min(maxValue, rangeInput.value));
                sliderValue.innerText = rangeInput.value; // æ›´æ–°è¾“å‡ºå€¼
                updateSliderValuesDisplay(); // æ›´æ–°<h3>çš„å€¼
            }

            function updateSliderValuesDisplay() {
                const sliderValues = Array.from(document.querySelectorAll('.output')).map((span, index) => {
                    const power = index; // å½“å‰æ»‘å—çš„å¹‚æ•°
                    return `${span.innerText}x^${power}`; // æŒ‰å¤šé¡¹å¼å½¢å¼æ„é€ å­—ç¬¦ä¸²
                });

                // å°†å¤šé¡¹å¼å€¼æ˜¾ç¤ºåœ¨ <h3> ä¸­
                document.getElementById('sliderValues').innerText = 'å½“å‰f(x): ' + sliderValues.join(' + ');
            }

            // æ·»åŠ è¾“å…¥æ¡†äº‹ä»¶å¤„ç†
            minInput.addEventListener('input', updateRange);
            maxInput.addEventListener('input', updateRange);
            rangeInput.addEventListener('input', function() {
                sliderValue.innerText = rangeInput.value; // æ›´æ–°è¾“å‡ºå€¼
                updateSliderValuesDisplay(); // æ›´æ–°<h3>çš„å€¼
            });

            // å°†æ–°çš„æ»‘å—å®¹å™¨æ·»åŠ åˆ°é¡µé¢
            document.getElementById('sliders').appendChild(sliderContainer);

            updateRange();
        }


        async function sendData() {  
            const sliderValues = Array.from(document.querySelectorAll('.output')).map((span, index) => {  
                return {power: index, value: parseFloat(span.innerText)};  
            });  

            await fetch('/solve', {  
                method: 'POST',  
                headers: {  
                    'Content-Type': 'application/json',  
                },  
                body: JSON.stringify(sliderValues),  
            })  
            .then(response => response.json())  
            .then(data => {  
                drawSolution(data);  
            })  
            .catch((error) => {  
                console.error('Error:', error);  
            });  
        }
        function drawSolution(data) {
            const xValues = data.x;
            const yValues = data.y;

            const xMin = Math.min(...xValues);
            const xMax = Math.max(...xValues);
            const yMin = Math.min(...yValues);
            const yMax = Math.max(...yValues);

            const xScale = 1 / (xMax - xMin);
            const yScale = 1 / (yMax - yMin);

            const plotlyData = [{
                type: 'scatter',
                mode: 'lines',
                x: xValues.map(x => (x - xMin) * xScale),
                y: yValues.map(y => 1 - ((y - yMin) * yScale)),
                line: {
                    color: '#007BFF',
                    width: 2
                }
            }];

            const plotlyLayout = {
                title: 'predicted function',
                xaxis: {
                    title: 'X ',
                },
                yaxis: {
                    title: 'u(x)',
                }
            };

            Plotly.newPlot('solutionCanvas', plotlyData, plotlyLayout);
                }
    </script>  
</body>  
</html>
